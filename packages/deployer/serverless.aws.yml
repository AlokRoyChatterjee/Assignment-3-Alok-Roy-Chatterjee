service: airnode-${opt:airnodeIdShort}

provider:
  name: aws
  region: ${opt:region}
  stage: ${opt:stage}
  runtime: nodejs12.x
  memorySize: 256
  logRetentionInDays: 14
  environment: ${file(secrets.json)}
  iam:
    role:
      statements:
        - Effect: 'Allow'
          Action: 'lambda:InvokeFunction'
          Resource: '*'

package: 
  individually: true

functions:
  startCoordinator:
    handler: ./.webpack/aws/index.startCoordinator
    timeout: 60
    reservedConcurrency: 1
    events:
      - schedule: rate(1 minute)
    package:
      patterns:
        - '!**'
        - .webpack/aws/index.js

  initializeProvider:
    handler: ./.webpack/aws/index.initializeProvider
    timeout: 20
    package:
      patterns:
        - '!**'
        - .webpack/aws/index.js

  callApi:
    handler: ./.webpack/aws/index.callApi
    timeout: 30
    package:
      patterns:
        - '!**'
        - .webpack/aws/index.js

  processProviderRequests:
    handler: ./.webpack/aws/index.processProviderRequests
    timeout: 10
    package:
      patterns:
        - '!**'
        - .webpack/aws/index.js
